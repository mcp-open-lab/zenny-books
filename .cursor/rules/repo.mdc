---
alwaysApply: true
---

# Project Context

You are an expert Full-Stack Developer building a "True MVP" Receipt Scanner.

- **Goal:** Fast, simple receipt capture → AI extraction → CSV export.
- **Philosophy:** Speed over complexity. Avoid over-engineering (no folders, no tags, no complex auth roles yet).
- **Stack:** Next.js 16 (App Router), Drizzle ORM, Clerk Auth, UploadThing, Google Gemini 2.0 Flash.

# Tech Stack & Best Practices

## Next.js 16 (App Router)

- **Data Fetching:** Always use **Server Components (RSC)** and `await` DB calls directly.
- **Mutations:** Always use **Server Actions** (`'use server'`) for form submissions and data updates.
- **State:** Use `useActionState` (from `react`) or standard `useState` only for local UI state (modals, inputs).
- **Routing:** Use `next/navigation` (`redirect`, `useRouter`, `usePathname`).
- **Images:** Always use `next/image` with `width` and `height` or `fill`.
- **Forbidden:** Do NOT use `useEffect` for data fetching. Do NOT use `/app/api` routes unless strictly required for webhooks (Clerk/UploadThing).

## Drizzle ORM (Database)

- **Schema:** Source of truth is `@/lib/db/schema.ts`.
- **Import:** Always import `db` from `@/lib/db`.
- **Query Style:** Prefer the SQL-like syntax: `await db.select().from(receipts)...`.
- **Mutations:** Use `await db.insert(receipts).values({...}).returning()`.
- **Validation:** Use Zod schemas that match the Drizzle schema constraints.
- **MVP Constraint:** We use a **single table** (`receipts`). Do not suggest creating relation tables (folders/tags) for this phase.

## AI Integration (Gemini)

- **Model:** Use gemini-2.0-flash-exp.
- **Pattern:** Direct-to-LLM. Send the image URL directly to Gemini's multimodal input.
- **Prompting:** Always request **JSON** output. Use strict prompt engineering to prevent Markdown wrapping (e.g., "Return raw JSON only, no code blocks").
- **Privacy:** Never log full base64 strings to the console.

## UI & Styling (shadcn/ui + Tailwind)

- **Components:** Use `npx shadcn@latest add [name]` pattern.
- **Icons:** Use `lucide-react`.
- **Responsiveness:** Mobile-first. Use `hidden md:block` for desktop-only features.
- **Feedback:** Use `sonner` for toasts (`toast.success`, `toast.error`).
- **Forms:** Use `react-hook-form` + `zod` + `shadcn/ui` Form components.

## Authentication (Clerk)

- **Server Side:** Use `auth()` from `@clerk/nextjs/server` to protect actions.
- **Client Side:** Use `useUser()` for UI logic.
- **Security:** Every DB query MUST filter by `.where(eq(receipts.userId, userId))`.

# File Structure Rules

- `app/actions/*`: Server Actions (mutations).
- `components/ui/*`: Primitive shadcn components.
- `components/[feature]/*`: Feature-specific components (e.g., `components/receipts/receipt-card.tsx`).
- `lib/db/*`: Database configuration and schema.
- `lib/ai/*`: AI utilities.
- `types/*`: Shared TypeScript interfaces.

# Coding Behavior

- **Concise:** Write code immediately. Do not explain basic concepts.
- **Type-Safe:** No `any`. precise TypeScript types.
- **Imports:** Use absolute imports (`@/...`).
- **Error Handling:** Server actions should return `{ success: boolean, error?: string }` objects.

Hard Rules

- **Docs** Never create markdown docs unless asked to.
- **Code Comments** Only create comments at the top of functions and to explain routes/server actions
- **Reasearch** Assume it is 2025 for web searches searches/research and find modern/new results
